

import os, sys

import numpy as np


output_dir = '/gscratch/spe/gvisan01/mutation_effect_predictions/full_pep/MAGE_A3_TCR_designs/proteinmpnn/'
pdbs = [
    'run418_run419_A0101_EVDPIGHLY_00_11.65_TRAV21_CAVTDLNDRLVF_TRBV5-1_CASALESNAQQVYF',
    'run418_run419_A0101_EVDPIGHLY_01_11.65_TRAV21_CAVLNAVAGEQSIWVF_TRBV5-1_CASALETGQPLYF',
    'run418_run419_A0101_EVDPIGHLY_02_11.67_TRAV21_CAVLNAVAGEQSIWVF_TRBV5-1_CASALETGQPLYF',
    'run418_run419_A0101_EVDPIGHLY_03_11.67_TRAV21_CAVLNAVAGEQSIWVF_TRBV5-1_CASALETGQPLYF',
    'run418_run419_A0101_EVDPIGHLY_04_11.68_TRAV21_CAVTDLNDRLVF_TRBV5-1_CASALESNAQQVYF',
    'run418_run419_A0101_EVDPIGHLY_05_11.68_TRAV21_CAVTDLNDRLVF_TRBV5-1_CASALESTAQQVYF',
    'run418_run419_A0101_EVDPIGHLY_06_11.69_TRAV21_CAVVDLNAQLVF_TRBV5-1_CASSEDAVSWYF',
    'run418_run419_A0101_EVDPIGHLY_07_11.70_TRAV21_CAVVDLNAQLVF_TRBV5-1_CASSEDAVSWYF',
    'run418_run419_A0101_EVDPIGHLY_08_11.71_TRAV21_CAVSSTASNARLVF_TRBV5-1_CASALESEAQQVYF',
    'run418_run419_A0101_EVDPIGHLY_09_11.71_TRAV21_CAVVDLNAQLVF_TRBV5-1_CASSKDAVSWYF',
    'run418_run419_A0101_EVDPIGHLY_10_11.72_TRAV21_CAVSSTKSNARLVF_TRBV5-1_CASALESQAQQVYF',
    'run418_run419_A0101_EVDPIGHLY_11_11.72_TRAV21_CAVSSTKSNARLVF_TRBV5-1_CASALESSAQQVYF',
    'run418_run419_A0101_EVDPIGHLY_12_11.77_TRAV21_CAVLDLDGQWVF_TRBV5-1_CASAKELGQPLYF',
    'run418_run419_A0101_EVDPIGHLY_13_11.78_TRAV21_CAVVSTASNGRAVF_TRBV5-1_CASSVTGVELYF',
    'run418_run419_A0101_EVDPIGHLY_14_11.78_TRAV21_CAVLDLDGRWVF_TRBV5-1_CASAPELGQPLYF',
    'run418_run419_A0101_EVDPIGHLY_15_11.78_TRAV21_CAVLDLDGQWVF_TRBV5-1_CASAPELGQPLYF',
    'run418_run419_A0101_EVDPIGHLY_16_11.79_TRAV21_CAVVSPKDNARPVF_TRBV5-1_CASSLDGVSLYF',
    'run418_run419_A0101_EVDPIGHLY_17_11.80_TRAV21_CAVLDLNGQLVF_TRBV5-1_CASAPELGLPLYF',
    'run418_run419_A0101_EVDPIGHLY_18_11.80_TRAV21_CAVLDLDGRLVF_TRBV5-1_CASAPELGQPLYF',
    'run418_run419_A0101_EVDPIGHLY_19_11.81_TRAV21_CAVLDLDGRWVF_TRBV5-1_CASAPELGQPLYF',
    'run418_run419_A0101_EVDPIGHLY_20_11.81_TRAV21_CAVVGLDARPVF_TRBV5-1_CASSEDGVSLYF',
    'run418_run419_A0101_EVDPIGHLY_21_11.81_TRAV21_CAVVSPLDNARPVF_TRBV5-1_CASSKDGVSLYF',
    'run418_run419_A0101_EVDPIGHLY_22_11.82_TRAV21_CAVVPCTLDGDTPVF_TRBV5-1_CASSEDGVSLYF',
    'run418_run419_A0101_EVDPIGHLY_23_11.82_TRAV21_CAVVSPYEGTRPVF_TRBV5-1_CASSLYGVDYYF',
    'run418_run419_A0101_EVDPIGHLY_24_11.83_TRAV21_CAVTSPLNNAQPVF_TRBV5-1_CASSLDGVSLYF',
    'run418_run419_A0101_EVDPIGHLY_25_11.83_TRAV21_CAVVSPYVGTRAVF_TRBV5-1_CASSLYGVEYYF',
    'run418_run419_A0101_EVDPIGHLY_26_11.85_TRAV21_CAVVPCTLDGDTPVF_TRBV5-1_CASSLDGVSLYF',
    'run418_run419_A0101_EVDPIGHLY_27_11.86_TRAV21_CAVVGLDARPVF_TRBV5-1_CASSEDGVSLYF',
    'run418_run419_A0101_EVDPIGHLY_28_11.86_TRAV21_CAVVPCTLDGDTPVF_TRBV5-1_CASSLDGVSLYF',
    'run418_run419_A0101_EVDPIGHLY_29_11.86_TRAV21_CAVVGLDARPVF_TRBV5-1_CASSRDGVSLYF'
  ]

peptide_seq = 'ESDPIVAQY' # MAGE-A3: 'EVDPIGHLY', Titin: 'ESDPIVAQY'
peptide_chain = 'B'
pdbdir = '/gscratch/spe/gvisan01/mutation_effect_predictions/full_pep/MAGE_A3_TCR_designs/pdbs'

for pdb in pdbs:
    print(pdb, flush=True)

    # make temp pdb dir with one pdb at a time
    temp_pdb_dir = os.path.join(output_dir, 'temp_pdbs')

    os.makedirs(temp_pdb_dir, exist_ok=False)
    
    os.system(f"cp {os.path.join(pdbdir, pdb + '.pdb')} {temp_pdb_dir}")

    os.system(f"python -u score_whole_peptide.py \
                                --folder_with_pdbs {temp_pdb_dir} \
                                --output_dir {output_dir} \
                                --peptide_seq {peptide_seq} \
                                --peptide_chain {peptide_chain} \
                                --num_seq_per_target 10 \
                                --batch_size 10")

    os.system(f"rm -r {temp_pdb_dir}")


